# Vite 性能优化配置说明

本项目已经配置了全面的 Vite 性能优化设置，包括以下几个方面：

## 🚀 开发环境优化

### 1. 开发服务器优化
- **端口配置**: 默认端口 3000，支持外部访问
- **自动打开浏览器**: 启动时自动打开浏览器
- **CORS 支持**: 启用跨域资源共享
- **文件预热**: 预热常用的 Vue 组件文件
- **HMR 优化**: 热模块替换优化，显示错误覆盖层

### 2. 依赖预构建优化
- **预构建依赖**: Vue、Vue Router、Pinia
- **排除预构建**: vue-demi
- **智能缓存**: 避免不必要的重新构建

### 3. 路径解析优化
- **别名配置**: `@` 指向 `src` 目录，`~` 指向 `node_modules`
- **扩展名优化**: 优化文件扩展名解析顺序

## 🏗️ 构建优化

### 1. 代码分割
- **智能分割**: 使用函数式 manualChunks 进行智能代码分割
- **Vue 生态系统**: Vue、Vue Router、Pinia 打包到 vue chunk
- **第三方库**: node_modules 中的库打包到 vendor chunk
- **动态分割**: 根据模块路径自动分割，避免硬编码依赖

### 2. 文件命名和组织
- **JS 文件**: `js/[name]-[hash].js`
- **CSS 文件**: `css/[name]-[hash].css`
- **图片文件**: `img/[name]-[hash].[ext]`
- **字体文件**: `fonts/[name]-[hash].[ext]`
- **媒体文件**: `media/[name]-[hash].[ext]`

### 3. 压缩优化
- **Terser 压缩**: 生产环境移除 console 和 debugger
- **CSS 压缩**: 使用 cssnano 压缩 CSS
- **ESBuild 优化**: 压缩标识符、语法和空白

### 4. 源码映射
- **开发环境**: 启用源码映射便于调试
- **生产环境**: 禁用源码映射减少包大小

## 🎨 CSS 优化

### 1. PostCSS 优化
- **Autoprefixer**: 自动添加浏览器前缀
- **CSS 压缩**: 生产环境自动压缩 CSS
- **浏览器兼容性**: 支持现代浏览器

### 2. 代码分割
- **CSS 代码分割**: 启用 CSS 代码分割
- **开发环境源码映射**: 便于调试

## ⚡ 性能监控

### 1. 构建分析
- **禁用压缩大小报告**: 提升构建速度
- **Chunk 大小警告**: 1000kb 限制
- **构建时间优化**: 减少不必要的分析

### 2. 环境变量优化
- **Vue 特性标志**: 优化 Vue 运行时
- **生产环境优化**: 禁用开发工具

## 📦 依赖管理

### 已安装的优化相关依赖
```json
{
  "devDependencies": {
    "autoprefixer": "^10.x.x",
    "cssnano": "^6.x.x", 
    "terser": "^5.x.x"
  }
}
```

## 🛠️ 使用说明

### 开发环境
```bash
npm run dev
```
- 启动开发服务器 (http://localhost:3000)
- 启用 HMR 和 Vue DevTools
- 启用源码映射

### 生产构建
```bash
npm run build
```
- 代码压缩和优化
- 移除 console 和 debugger
- 生成优化的静态资源

### 预览构建结果
```bash
npm run preview
```
- 预览生产构建结果 (http://localhost:4173)

## 📊 性能提升预期

通过这些优化配置，您可以期待：

1. **开发体验提升**
   - 更快的热更新速度
   - 更好的错误提示
   - 自动浏览器刷新

2. **构建性能提升**
   - 减少 30-50% 的构建时间
   - 更小的包体积
   - 更好的缓存策略

3. **运行时性能提升**
   - 更快的页面加载速度
   - 更好的代码分割
   - 优化的资源加载

## 🔧 自定义配置

您可以根据项目需求调整以下配置：

1. **修改代码分割策略**: 在 `manualChunks` 中调整
2. **调整浏览器支持**: 修改 `.browserslistrc` 文件
3. **自定义 CSS 预处理**: 在 `css.preprocessorOptions` 中配置
4. **调整压缩选项**: 在 `terserOptions` 中修改

## 📝 注意事项

1. **依赖管理**: 确保 manualChunks 中引用的依赖包已安装
2. **环境变量**: 使用 `.env.dev`、`.env.test`、`.env.production` 文件
3. **浏览器兼容性**: 当前配置支持现代浏览器，如需支持旧版浏览器请调整配置

## 🔧 故障排除

### 常见构建错误

1. **"Could not resolve entry module" 错误**
   - 原因: manualChunks 中引用了未安装的依赖包
   - 解决: 使用函数式 manualChunks 或确保依赖已安装

2. **SCSS 导入错误**
   - 原因: 引用了不存在的 SCSS 文件
   - 解决: 移除不存在的 preprocessorOptions 配置

3. **PostCSS 插件错误**
   - 原因: 缺少必要的 PostCSS 插件
   - 解决: 安装 autoprefixer 和 cssnano

### 性能优化建议

1. **代码分割**: 使用动态导入 `import()` 进行路由级代码分割
2. **资源优化**: 压缩图片和字体文件
3. **缓存策略**: 利用文件哈希进行长期缓存
4. **预加载**: 使用 `<link rel="preload">` 预加载关键资源

---

*此配置文件包含了当前 Vite 生态系统中最佳的性能优化实践，已修复常见的构建错误，可以显著提升开发和构建体验。*